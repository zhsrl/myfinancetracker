<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Fin</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" href="/assets/favicon.ico">
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">
    <link rel="manifest" href="/assets/site.webmanifest">
    <link rel="stylesheet" href="css/style.css">

</head>

<body class="bg-gray-100 dark:bg-gray-900 min-h-screen font-sans">

    <!-- 
      НОВЫЙ БЛОК: ЭКРАН ЗАГРУЗКИ
      (Показывается по умолчанию, скрывается после проверки Auth)
    -->
    <div id="loading-spinner-container" class="fixed inset-0 bg-gray-100 dark:bg-gray-900 flex items-center justify-center z-50">
        <i class="fas fa-spinner fa-spin text-blue-600 dark:text-blue-400 text-5xl"></i>
    </div>

    <!-- 
      НОВЫЙ БЛОК: ЭКРАН АВТОРИЗАЦИИ
      (Показывается по умолчанию, скрывается после входа)
    -->
    <div id="auth-container" class="min-h-screen flex items-center justify-center p-4 hidden"> <!-- ИЗМЕНЕНИЕ: Добавлен 'hidden' -->
        <div class="w-full max-w-md bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8">
            <!-- <h2 class="text-3xl font-bold text-center text-gray-900 dark:text-white mb-6">MyFin</h2> -->
            <img id="auth-logo"  src="assets/logo.svg",  width="150"/>
            
            <!-- Табы Вход/Регистрация -->
            <div class="flex mb-6 border-b border-gray-200 dark:border-gray-700">
                <button id="auth-tab-login" class="flex-1 py-3 font-semibold text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400">
                    Вход
                </button>
                <button id="auth-tab-register" class="flex-1 py-3 font-semibold text-gray-500 dark:text-gray-400">
                    Регистрация
                </button>
            </div>

            <!-- 
                ВОССТАНОВЛЕННЫЙ HTML
                (Эти формы отсутствовали в вашем файле)
            -->
            <!-- Форма Входа -->
            <form id="auth-form-login" class="space-y-6">
                <div>
                    <label for="login-email" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Email</label>
                    <input type="email" id="login-email" placeholder='${strings.auth.emailPlaceholder}' class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white" required>
                </div>
                <div>
                    <label for="login-password" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Пароль</label>
                    <input type="password" id="login-password" placeholder="Пароль" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white" required>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-all">
                    Войти
                </button>
            </form>

            <!-- Форма Регистрации -->
            <form id="auth-form-register" class="space-y-6 hidden">
                <div>
                    <label for="register-email" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Email</label>
                    <input type="email" id="register-email" placeholder="email@example.com" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white" required>
                </div>
                <div>
                    <label for="register-password" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Пароль</label>
                    <input type="password" id="register-password" placeholder="Мин. 6 символов" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white" required>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-all">
                    Создать аккаунт
                </button>
            </form>
            
            <!-- Сообщение об ошибке -->
            <p id="auth-error" class="text-red-500 text-center mt-4"></p>
            
        </div> <!-- /div wrapper -->
    </div> <!-- /div#auth-container -->

        <!-- 
            ИСПРАВЛЕНИЕ:
            Модальные окна и боковая панель вынесены
            ИЗ #auth-container и являются его "соседями"
        -->
        
        <!-- 
            ВОССТАНОВЛЕННЫЙ HTML (Эти модальные окна отсутствовали)
        -->

        <!-- 1. Модальное окно: Новая Транзакция -->
        <div id="transaction-modal" class="fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex justify-center items-end sm:items-center p-4 z-50 hidden fade-in">
            <div class="bg-white dark:bg-gray-800 rounded-t-2xl sm:rounded-2xl shadow-xl w-full max-w-lg p-6 relative">
                <button id="close-transaction-modal" class="absolute top-4 right-4 text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">
                    <i class="fas fa-times fa-lg"></i>
                </button>
                <h3 id="transaction-modal-title" class="text-2xl font-bold text-center text-gray-900 dark:text-white mb-6">Новая операция</h3>
                
                <form id="transaction-form">
                    <input type="hidden" id="transaction-type" value="expense">
                    
                    <!-- Описание -->
                    <div class="mb-4">
                        <label for="transaction-description" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Описание</label>
                        <input type="text" id="transaction-description" placeholder="Напр., Покупка в Magnum" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white" required>
                    </div>
                    <!-- Сумма -->
                    <div class="mb-4">
                        <label for="transaction-amount" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Сумма (₸)</label>
                        <input type="number" id="transaction-amount" placeholder="5000" step="any" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white" required>
                    </div>
                    <!-- Счет -->
                    <div class="mb-4">
                        <label for="transaction-account" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Счет</label>
                        <select id="transaction-account" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white appearance-none" required>
                            <!-- Опции счетов -->
                        </select>
                    </div>
                    <!-- Категория (только для расходов) -->
                    <div id="category-container" class="mb-4">
                        <label for="transaction-category" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Категория</label>
                        <select id="transaction-category" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white appearance-none">
                            <!-- Опции категорий -->
                        </select>
                    </div>
                    <!-- Контейнер для выбора кредита (скрыт по умолч.) -->
                    <div id="loan-payment-container" class="mb-4 hidden">
                        <label for="transaction-loan-select" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Какой кредит оплачиваете?</label>
                        <select id="transaction-loan-select" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white appearance-none">
                            <!-- Опции кредитов -->
                        </select>
                    </div>
                    <!-- Контейнер для выбора сберегательного счета (скрыт по умолч.) -->
                    <div id="savings-transfer-container" class="mb-4 hidden">
                        <label for="transaction-savings-select" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">На какой сберегательный счет?</label>
                        <select id="transaction-savings-select" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white appearance-none">
                            <!-- Опции сберегательных счетов -->
                        </select>
                    </div>
                    
                    <button id="submit-transaction-btn" type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-all">
                        Добавить
                    </button>
                </form>
            </div>
        </div>

        <!-- 2. Модальное окно: Новый Счет -->
        <div id="account-modal" class="fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex justify-center items-end sm:items-center p-4 z-50 hidden fade-in">
            <div class="bg-white dark:bg-gray-800 rounded-t-2xl sm:rounded-2xl shadow-xl w-full max-w-lg p-6 relative">
                <button id="close-account-modal" class="absolute top-4 right-4 text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">
                    <i class="fas fa-times fa-lg"></i>
                </button>
                <h3 class="text-2xl font-bold text-center text-gray-900 dark:text-white mb-6">Новый счет</h3>
                
                <form id="account-form">
                    <!-- Тип счета -->
                    <div class="mb-4">
                        <label for="account-type" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Тип счета</label>
                        <select id="account-type" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white appearance-none">
                            <option value="bank">Банк</option>
                            <option value="deposit">Депозит</option>
                            <option value="savings">Сбережение</option>
                            <option value="cash">Наличный</option>
                        </select>
                    </div>
                    
                     <!-- Выбор банка (появляется если тип "Банк") -->
                                       <div id="bank-logo-container" class="mb-4">
                         <label class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Выберите банк</label>
                         <div class="grid grid-cols-3 gap-3 justify-center">
                            
                            
                            <div class="bank-logo" data-bank-name="Kaspi Bank" data-bank-logo-url="https://kaspi.kz/img/Logo.svg">
                                <img src="https://kaspi.kz/img/Logo.svg" alt="Kaspi Bank" onerror="event.target.parentElement.innerHTML = 'K'; event.target.parentElement.classList.add('logo-fallback');">
                            </div>
                             <div class="bank-logo" data-bank-name="Freedom Bank" data-bank-logo-url="https://bankffin.kz/images/invest-card-promo/briefcase-icons/bankffin.svg">
                                <img src="https://bankffin.kz/images/invest-card-promo/briefcase-icons/bankffin.svg" alt="Freedom Bank" onerror="event.target.parentElement.innerHTML = 'F'; event.target.parentElement.classList.add('logo-fallback');">
                            </div>
                            <div class="bank-logo" data-bank-name="Halyk Bank" data-bank-logo-url="https://halykbank.kz/storage/app/uploads/public/652/cf7/01b/652cf701be5b8939869157.svg">
                                <img src="https://halykbank.kz/storage/app/uploads/public/652/cf7/01b/652cf701be5b8939869157.svg" alt="Halyk Bank" onerror="event.target.parentElement.innerHTML = 'H'; event.target.parentElement.classList.add('logo-fallback');">
                            </div>
                            <div class="bank-logo" data-bank-name="ForteBank" data-bank-logo-url="https://forte.kz/_next/image?url=https%3A%2F%2Fmain.storage-object.pscloud.io%2FFrame_2087330514_20281c4df7.svg&w=768&q=85">
                                 <img src="https://forte.kz/_next/image?url=https%3A%2F%2Fmain.storage-object.pscloud.io%2FFrame_2087330514_20281c4df7.svg&w=768&q=85" alt="ForteBank" onerror="event.target.parentElement.innerHTML = 'F'; event.target.parentElement.classList.add('logo-fallback');">
                            </div>
                            <div class="bank-logo" data-bank-name="CenterCredit" data-bank-logo-url="https://www.bcc.kz/themes/bcc/assets/images/logo.svg">
                                <img src="https://www.bcc.kz/themes/bcc/assets/images/logo.svg" alt="CenterCredit" onerror="event.target.parentElement.innerHTML = 'B'; event.target.parentElement.classList.add('logo-fallback');">
                            </div>
                             <div class="bank-logo" data-bank-name="Home Credit Bank" data-bank-logo-url="https://home.kz/_nuxt/logo-HCB-1.OFS24jPA.png">
                                <img src="https://home.kz/_nuxt/logo-HCB-1.OFS24jPA.png" alt="Home Credit Bank" onerror="event.target.parentElement.innerHTML = 'H'; event.target.parentElement.classList.add('logo-fallback');">
                            </div>
                                <div class="bank-logo" data-bank-name="Eurasian Bank" data-bank-logo-url="https://eubank.kz/file/2024/12/Logo_EU_1397h478.png">
                                <img src="https://eubank.kz/file/2024/12/Logo_EU_1397h478.png" alt="Eurasian Bank" onerror="event.target.parentElement.innerHTML = 'E'; event.target.parentElement.classList.add('logo-fallback');">
                            </div>
                         </div>
                         <input type="hidden" id="account-logo-url">
                    </div>
                    <!-- Название -->
                    <div class="mb-4">
                        <label for="account-name" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Название</label>
                        <input type="text" id="account-name" placeholder="Напр., Kaspi Gold" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white" required>
                    </div>
                    <!-- Баланс -->
                    <div class="mb-4">
                        <label for="account-balance" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Текущий баланс (₸)</label>
                        <input type="number" id="account-balance" placeholder="100000" value="0" step="any" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white" required>
                    </div>
                    <!-- Цвет карты -->
                    <div id="color-picker" class="mb-6">
                        <label class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Цвет карты</label>
                        <div class="flex gap-2">
                            <div class="color-swatch" data-color="from-gray-500 to-gray-700" style="background: linear-gradient(to right bottom, #6b7280, #374151)"></div>
                            <div class="color-swatch" data-color="from-red-500 to-red-700" style="background: linear-gradient(to right bottom, #ef4444, #b91c1c)"></div>
                            <div class="color-swatch" data-color="from-blue-500 to-blue-700" style="background: linear-gradient(to right bottom, #3b82f6, #1d4ed8)"></div>
                            <div class="color-swatch" data-color="from-green-500 to-green-700" style="background: linear-gradient(to right bottom, #22c55e, #15803d)"></div>
                            <div class="color-swatch" data-color="from-yellow-500 to-yellow-700" style="background: linear-gradient(to right bottom, #eab308, #b45309)"></div>
                            <div class="color-swatch" data-color="from-purple-500 to-purple-700" style="background: linear-gradient(to right bottom, #a855f7, #7e22ce)"></div>
                            <div class="color-swatch" data-color="from-pink-500 to-pink-700" style="background: linear-gradient(to right bottom, #ec4899, #be185d)"></div>
                        </div>
                        <input type="hidden" id="account-color" value="from-gray-500 to-gray-700">
                    </div>

                    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-all">
                        Добавить счет
                    </button>
                </form>
            </div>
        </div>

        <!-- 3. Модальное окно: Новый кредит -->
        <div id="loan-modal" class="fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex justify-center items-end sm:items-center p-4 z-50 hidden fade-in">
            <div class="bg-white dark:bg-gray-800 rounded-t-2xl sm:rounded-2xl shadow-xl w-full max-w-lg p-6 relative">
                <button id="close-loan-modal" class="absolute top-4 right-4 text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">
                    <i class="fas fa-times fa-lg"></i>
                </button>
                <h3 class="text-2xl font-bold text-center text-gray-900 dark:text-white mb-6">Новый кредит</h3>
                
                <form id="loan-form">
                    <!-- Название -->
                    <div class="mb-4">
                        <label for="loan-name" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Название</label>
                        <input type="text" id="loan-name" placeholder="Напр., Halyk (Iphone)" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white" required>
                    </div>
                    <!-- Общая сумма -->
                    <div class="mb-4">
                        <label for="loan-total-amount" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Общая сумма (₸)</label>
                        <input type="number" id="loan-total-amount" placeholder="500000" step="any" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white" required>
                    </div>
                    <!-- Уже оплачено -->
                    <div class="mb-4">
                        <label for="loan-paid-amount" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Уже оплачено (₸)</label>
                        <input type="number" id="loan-paid-amount" placeholder="0" value="0" step="any" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white" required>
                    </div>
                    <!-- Ежемесячный платеж -->
                    <div class="mb-4">
                        <label for="loan-monthly-payment" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Ежемесячный платеж (₸)</label>
                        <input type="number" id="loan-monthly-payment" placeholder="50000" step="any" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white" required>
                    </div>
                    <!-- Число платежа -->
                    <div class="mb-4">
                        <label for="loan-payment-date" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Число ежемесячного платежа</label>
                        <input type="number" id="loan-payment-date" placeholder="Напр., 15" min="1" max="31" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white" required>
                    </div>
                    
                    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-all">
                        Добавить кредит
                    </button>
                </form>
            </div>
        </div>

        <!-- 4. Модальное окно: Новый долг (НОВЫЙ) -->
        <div id="debt-modal" class="fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex justify-center items-end sm:items-center p-4 z-50 hidden fade-in">
            <div class="bg-white dark:bg-gray-800 rounded-t-2xl sm:rounded-2xl shadow-xl w-full max-w-lg p-6 relative">
                <button id="close-debt-modal" class="absolute top-4 right-4 text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">
                    <i class="fas fa-times fa-lg"></i>
                </button>
                <h3 id="debt-modal-title" class="text-2xl font-bold text-center text-gray-900 dark:text-white mb-6">Новый долг</h3>
                
                <form id="debt-form">
                    <!-- Название/Имя -->
                    <div class="mb-4">
                        <label for="debt-name" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Название / Кому</label>
                        <input type="text" id="debt-name" placeholder="Напр., Долг Асану" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white" required>
                    </div>
                    <!-- Описание -->
                    <div class="mb-4">
                        <label for="debt-description" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Описание</label>
                        <input type="text" id="debt-description" placeholder="Напр., На покупку" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white">
                    </div>
                    <!-- Общая сумма -->
                    <div class="mb-4">
                        <label for="debt-total-amount" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Сумма (₸)</label>
                        <input type="number" id="debt-total-amount" placeholder="50000" step="any" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white" required>
                    </div>
                    <!-- Дата возврата -->
                    <div class="mb-4">
                        <label for="debt-payment-date" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Дата возврата</label>
                        <input type="date" id="debt-payment-date" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white" required>
                    </div>
                    
                    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-all">
                        Добавить долг
                    </button>
                </form>
            </div>
        </div>


        <!-- 5. Модальное окно: Вся история -->
        <div id="history-modal" class="fixed inset-0 bg-gray-100 dark:bg-gray-900 z-50 hidden overflow-y-auto fade-in">
            <div class="max-w-2xl mx-auto p-4 sm:p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Вся история</h2>
                    <button id="close-history-modal" class="text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">
                        <i class="fas fa-times fa-lg"></i>
                    </button>
                </div>
                
                <div id="all-history-content" class="space-y-6">
                    <!-- Контент будет добавлен JS -->
                </div>
            </div>
        </div>

        <!-- 
            КОНЕЦ ВОССТАНОВЛЕННОГО HTML
        -->


        <!-- 6. Модальное окно: Детали долга -->
        <div id="debt-details-modal" class="fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex justify-center items-center p-4 z-50 hidden fade-in">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-sm p-6 relative">
                <button id="close-debt-details-modal" class="absolute top-4 right-4 text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">
                    <i class="fas fa-times fa-lg"></i>
                </button>
                <h3 id="debt-details-title" class="text-2xl font-bold text-center text-gray-900 dark:text-white mb-6">Детали долга</h3>
                
                <div class="space-y-4">
                    <div class="flex justify-between items-center bg-gray-100 dark:bg-gray-700 p-4 rounded-lg">
                        <span id="details-loan-debt-label" class="font-medium text-gray-700 dark:text-gray-300">Долг по кредитам</span>
                        <span id="details-loan-debt" class="font-bold text-lg text-gray-900 dark:text-white">0 ₸</span>
                    </div>
                    <div class="flex justify-between items-center bg-gray-100 dark:bg-gray-700 p-4 rounded-lg">
                        <span id="details-simple-debt-label" class="font-medium text-gray-700 dark:text-gray-300">Простые долги</span>
                        <span id="details-simple-debt" class="font-bold text-lg text-gray-900 dark:text-white">0 ₸</span>
                    </div>
                    <hr class="dark:border-gray-600">
                    <div class="flex justify-between items-center p-2">
                        <span id="details-total-debt-label" class="font-semibold text-lg text-gray-900 dark:text-white">Итого</span>
                        <span id="details-total-debt" class="font-bold text-xl text-red-600 dark:text-red-500">0 ₸</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 7. Модальное окно: Детали сбережений (ИЗМЕНЕНО) -->
        <div id="savings-details-modal" class="fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex justify-center items-center p-4 z-50 hidden fade-in">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-sm p-6 relative">
                <button id="close-savings-details-modal" class="absolute top-4 right-4 text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">
                    <i class="fas fa-times fa-lg"></i>
                </button>
                <h3 id="savings-details-title" class="text-2xl font-bold text-center text-gray-900 dark:text-white mb-6">Детали сбережений</h3>
                
                <div class="space-y-4">
                    <!-- 
                        ИЗМЕНЕНИЕ: 
                        Статичный блок "Сбережения" заменен на динамический контейнер
                    -->
                    <div id="savings-breakdown-container" class="space-y-2 max-h-40 overflow-y-auto">
                        <!-- Сюда будут вставлены сберегательные счета -->
                    </div>

                    <div class="flex justify-between items-center bg-gray-100 dark:bg-gray-700 p-4 rounded-lg">
                        <span id="details-deposit-label" class="font-medium text-gray-700 dark:text-gray-300">Депозиты</span>
                        <span id="details-deposit" class="font-bold text-lg text-gray-900 dark:text-white">0 ₸</span>
                    </div>
                    <hr class="dark:border-gray-600">
                    <div class="flex justify-between items-center p-2">
                        <span id="details-total-savings-label" class="font-semibold text-lg text-gray-900 dark:text-white">Итого</span>
                        <span id="details-total-savings" class="font-bold text-xl text-green-600 dark:text-green-500">0 ₸</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 8. Модальное окно: Оплата долга (НОВОЕ) -->
        <div id="pay-debt-modal" class="fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex justify-center items-center p-4 z-50 hidden fade-in">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-sm p-6 relative">
                <button id="close-pay-debt-modal" class="absolute top-4 right-4 text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">
                    <i class="fas fa-times fa-lg"></i>
                </button>
                <h3 id="pay-debt-modal-title" class="text-2xl font-bold text-center text-gray-900 dark:text-white mb-4">Оплата долга</h3>
                
                <p id="pay-debt-info" class="text-center text-lg text-gray-700 dark:text-gray-300 mb-6">Загрузка...</p>

                <form id="pay-debt-form">
                    <div class="mb-6">
                        <label for="pay-debt-account-select" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">С какого счета оплатить?</label>
                        <select id="pay-debt-account-select" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white appearance-none" required>
                            <!-- Опции для счетов будут добавлены JS -->
                        </select>
                    </div>

                    <input type="hidden" id="pay-debt-id-input">
                    <input type="hidden" id="pay-debt-amount-input">
                    <input type="hidden" id="pay-debt-name-input">
                    
                    <button type="submit" id="submit-pay-debt-btn" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition-all">
                        Оплатить
                    </button>
                </form>
            </div>
        </div>
        
        <!-- 9. Модальное окно: Закрытые кредиты (НОВОЕ) -->
        <div id="closed-loans-modal" class="fixed inset-0 bg-gray-100 dark:bg-gray-900 z-50 hidden overflow-y-auto fade-in">
            <div class="max-w-2xl mx-auto p-4 sm:p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="closed-loans-title" class="text-2xl font-bold text-gray-900 dark:text-white">Закрытые кредиты</h2>
                    <button id="close-closed-loans-modal" class="text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">
                        <i class="fas fa-times fa-lg"></i>
                    </button>
                </div>
                
                <div id="closed-loans-content" class="space-y-3">
                    <!-- Контент будет добавлен JS -->
                </div>
            </div>
        </div>


        <!-- 
          Боковая панель (Drawer)
        -->
        <div id="drawer-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden transition-opacity duration-300"></div>
        <div id="drawer-content" class="fixed top-0 left-0 h-full w-80 max-w-[80%] bg-white dark:bg-gray-800 shadow-2xl z-40 transform -translate-x-full transition-transform duration-300 p-6 overflow-y-auto flex flex-col">
            <div class="flex-grow">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">Настройки</h2>
            
                <!-- Блок Модели бюджета -->
                <div>
                    <label for="budget-model-select" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Модель Управления</label>
                    <select id="budget-model-select" class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white appearance-none">
                        <option value="none">Не выбрана</option>
                        <option value="50-30-20">50 / 30 / 20</option>
                        <option value="80-20">80 / 20 (Накопление)</option>
                    </select>
                    
                    <div id="model-display" class="mt-6 space-y-3">
                        <p class="text-gray-500 dark:text-gray-400">Выберите модель, чтобы увидеть распределение.</p>
                    </div>
                </div>
                
                <hr class="my-6 dark:border-gray-600">
                
                <div class="text-left text-xs text-gray-400">
                    Вы вошли как: <br> <strong id="user-email-display" class="font-mono text-sm break-words">...</strong> 
                </div>
                   <div class="text-left text-xs text-gray-400">
                    User ID: <br> <strong id="user-id-display" class="font-mono text-sm break-words">...</strong> 
                </div>
            </div>
            
            <!-- Кнопка Выхода -->
            <div class="mt-6">
                <button id="logout-button" class="w-full flex items-center justify-center gap-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 p-3 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-all">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="font-semibold">Выйти</span>
                </button>
            </div>
        </div>

        <!-- 
            ИСПРАВЛЕНИЕ:
            Добавлен недостающий открывающий тег
            <div id="main-app" class="hidden">
        -->
        <div id="main-app" class="hidden">

            <!-- 
              Основной контент страницы
            -->
            <!-- Шапка -->
            <header class="flex justify-between items-center p-4 sticky top-0 bg-gray-100 dark:bg-gray-900 z-20">
                <!-- ВОССТАНОВЛЕННЫЙ HTML -->
                <button id="menu-toggle" class="text-2xl text-gray-700 dark:text-gray-300">
                    <i class="fas fa-bars"></i>
                </button>
                <!-- <h1 id="app-title-header" class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white">MyFin</h1> -->
                <img id="app-title-header"  src="assets/logo.svg",  width="150"/>
                <!-- ИЗМЕНЕНИЕ: Заглушка заменена на переключатель языка -->
                <div class="flex gap-1 sm:gap-2">
                    <button id="lang-toggle-ru" class="font-semibold p-2 rounded-lg text-sm w-10 text-blue-600 dark:text-blue-400 bg-blue-100 dark:bg-gray-700">RU</button>
                    <button id="lang-toggle-kk" class="font-semibold p-2 rounded-lg text-sm w-10 text-gray-500 dark:text-gray-400">KK</button>
                </div>
            </header>

            <!-- Адаптивная сетка -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 p-4"> <!-- ВОЗВРАЩАЕМ PADDING -->

                <!-- Левая колонка (Балансы и Слайдеры) -->
                <div class="space-y-6">
                    
                    <!-- Балансы -->
                    <!-- Общий Баланс (теперь во всю ширину) -->
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md text-center">
                        <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Общий баланс</span>
                        <p id="total-balance" class="text-3xl font-bold text-gray-900 dark:text-white truncate">0 ₸</p>
                    </div>

                    <!-- Новая сетка для Сбережений и Кредитов -->
                    <div class="grid grid-cols-2 gap-4">
                        <!-- Сбережения -->
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-2xl shadow-md text-center">
                            <span id="savings-label" class="text-sm font-medium text-gray-500 dark:text-gray-400">Сбережения</span>
                            <p id="savings-balance" class="text-2xl font-bold text-green-600 dark:text-green-500 truncate">0 ₸</p>
                            <!-- НОВАЯ КНОПКА -->
                            <button id="show-savings-details-btn" class="text-xs text-blue-600 dark:text-blue-400 hover:underline mt-1">Детали</button>
                        </div>
                        <!-- Общий долг -->
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-2xl shadow-md text-center">
                            <span id="total-loan-label" class="text-sm font-medium text-gray-500 dark:text-gray-400">Общий долг</span>
                            <p id="total-loans-balance" class="text-2xl font-bold text-red-600 dark:text-red-500 truncate">0 ₸</p>
                            <!-- НОВАЯ КНОПКА -->
                            <button id="show-debt-details-btn" class="text-xs text-blue-600 dark:text-blue-400 hover:underline mt-1">Детали</button>
                        </div>
                    </div>

                    <!-- Модель бюджета на главном -->
                    <div id="main-model-display" class="bg-white dark:bg-gray-800 p-4 rounded-2xl shadow-md">
                         <p id="main-model-placeholder" class="text-center text-gray-500 dark:text-gray-400">Выберите модель бюджета в настройках</p>
                    </div>
                    
                    <!-- КНОПКИ Доход/Расход -->
                    <div class="grid grid-cols-2 gap-4">
                        <button id="nav-income" class="flex items-center justify-center gap-2 bg-green-100 dark:bg-green-800 text-green-700 dark:text-green-300 p-4 rounded-2xl shadow-md hover:bg-green-200 dark:hover:bg-green-700 transition-all">
                            <i class="fas fa-plus-circle fa-lg"></i>
                            <span id="nav-income-label" class="text-lg font-semibold">Доход</span>
                        </button>
                        <button id="nav-expense" class="flex items-center justify-center gap-2 bg-red-100 dark:bg-red-800 text-red-700 dark:text-red-300 p-4 rounded-2xl shadow-md hover:bg-red-200 dark:hover:bg-red-700 transition-all">
                            <i class="fas fa-minus-circle fa-lg"></i>
                            <span id="nav-expense-label" class="text-lg font-semibold">Расход</span>
                        </button>
                    </div>

                    <!-- Слайдер Счетов -->
                    <div>
                        <div class="flex justify-between items-center mb-3">
                            <h2 id="accounts-title" class="text-xl font-bold text-gray-900 dark:text-white">Счета</h2>
                            <button id="add-account-btn" class="text-blue-600 dark:text-blue-400 font-semibold text-sm hover:underline">
                                + Новый счет
                            </button>
                        </div>
                        <div id="accounts-slider" class="slider-container flex overflow-x-auto gap-4 py-2 scroll-snap-x-mandatory">
                            <!-- Карточки счетов будут добавлены JS -->
                            <div id="no-accounts" class="text-center text-gray-500 dark:text-gray-400 w-full p-10">
                                У вас пока нет счетов.
                            </div>
                        </div>
                    </div>

                    <!-- Слайдер Кредитов -->
                    <div>
                        <div class="flex justify-between items-center mb-3">
                            <h2 id="loans-title" class="text-xl font-bold text-gray-900 dark:text-white">Кредиты</h2>
                            <!-- ИЗМЕНЕНИЕ: Кнопки в группе -->
                            <div class="flex gap-4">
                                <button id="show-closed-loans-btn" class="text-gray-500 dark:text-gray-400 font-semibold text-sm hover:underline">
                                    <i class="fas fa-archive text-xs"></i> Закрытые
                                </button>
                                <button id="add-loan-btn" class="text-blue-600 dark:text-blue-400 font-semibold text-sm hover:underline">
                                    + Новый кредит
                                </button>
                            </div>
                        </div>
                        <div id="loans-slider" class="slider-container flex overflow-x-auto gap-4 py-2 scroll-snap-x-mandatory">
                            <!-- Карточки кредитов будут добавлены JS -->
                            <div id="no-loans" class="text-center text-gray-500 dark:text-gray-400 w-full p-10">
                                У вас нет активных кредитов.
                            </div>
                        </div>
                    </div>
                    
                    <!-- НОВЫЙ БЛОК: Слайдер Долгов -->
                    <div>
                        <div class="flex justify-between items-center mb-3">
                            <h2 id="debts-title" class="text-xl font-bold text-gray-900 dark:text-white">Долги</h2>
                            <button id="add-debt-btn" class="text-blue-600 dark:text-blue-400 font-semibold text-sm hover:underline">
                                + Новый долг
                            </button>
                        </div>
                        <div id="debts-slider" class="slider-container flex overflow-x-auto gap-4 py-2 scroll-snap-x-mandatory">
                            <!-- Карточки долгов будут добавлены JS -->
                            <div id="no-debts" class="text-center text-gray-500 dark:text-gray-400 w-full p-10">
                                У вас нет простых долгов.
                            </div>
                        </div>
                    </div>

                    <!-- Статус по кредитам -->
                    <div id="loan-status-widget" class="space-y-3">
                        <!-- Статус будет добавлен JS -->
                    </div>

                </div> <!-- Конец левой колонки -->

                <!-- Правая колонка (История) -->
                <div>
                    <div class="flex justify-between items-center mb-3">
                        <h2 id="history-title" class="text-xl font-bold text-gray-900 dark:text-white">История (Сегодня)</h2>
                        <button id="show-all-history-btn" class="text-blue-600 dark:text-blue-400 font-semibold text-sm hover:underline">
                            Все <i class="fas fa-arrow-right text-xs"></i>
                        </button>
                    </div>
                    <div id="history-list" class="space-y-3">
                        <div id="no-history" class="text-center text-gray-500 dark:text-gray-400 p-10 bg-white dark:bg-gray-800 rounded-2xl shadow-md">
                            Сегодня операций не было.
                        </div>
                        <!-- Список транзакций будет добавлен JS -->
                    </div>
                </div> <!-- Конец правой колонки -->
            
            </div> <!-- Конец адаптивной сетки -->

        </div> <!-- Конец основного контента -->

    </div> <!-- Конец #main-app -->


    <!-- 
      Кастомное Toast уведомление
    -->
    <div id="toast-notification" class="fixed bottom-4 left-4 right-4 sm:left-auto sm:right-4 sm:w-96 p-4 rounded-lg shadow-lg z-50 transition-all duration-500">
        <p id="toast-message" class="font-semibold text-white">Сообщение</p>
    </div>


    <!-- 
      СКРИПТЫ
    -->
    <script type="module" src="js/app.js"></script>

</body>
</html>